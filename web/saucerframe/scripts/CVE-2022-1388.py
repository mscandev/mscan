#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Copyright (c) saucerman (https://saucer-man.com)
See the file 'LICENSE' for copying permission
"""

# refer: https://github.com/MrCl0wnLab/Nuclei-Template-CVE-2022-1388-BIG-IP-iControl-REST-Exposed
# detail: https://support.f5.com/csp/article/K23605346
# fofa keywords: title="BIG-IP&reg;- Redirect"
from lib.core.Request import request
from plugin.target_parse import get_standard_url
import json

def poc(url):
    base = get_standard_url(url)
    vuln_url = f"{base}/mgmt/shared/authn/login"
    try:
        r = request.get(vuln_url, verify=False, timeout=5)
        json.loads(r.text)
        if "resterrorresponse" in r.text or "message" in r.text:
            return vuln_url
    except:
        pass
    return False
